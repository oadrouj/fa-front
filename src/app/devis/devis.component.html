<p-confirmDialog [style]="{width: '50vw', height: '100%'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text">
</p-confirmDialog>
<p-toast [style]="{marginTop: 'marginTop'}" styleClass="styleClass"></p-toast>

<div class="main grid pt-6">

    <div class="w-57 md:col-12 p-0 positon-relative">
        <div class="pl-3">
            <div class="header flex justify-content-between align-items-start">
                <div class="flex  flex-wrap align-items-start">
                    <img src="assets/img/DevisIcon.png" class="mr-3" />
                    <h1 class="title color-green">DEVIS</h1>
                </div>

                <button pButton (click)="displayDialog = true" class="bg-green btn-new-devis text-normal" label="Nouvelle Devis"></button>

            </div>
            <p class="subtitle">Visualisez, modifiez et gérez toutes vos factures !</p>

            <span class="p-input-icon-left mt-2">
                <i class="pi pi-search"></i>
                <input pInputText [(ngModel)]="searchText" class="searchInput" placeholder="Rechercher ici" />
            </span>

            <div class="flex align-items-center pt-5 filterContainer">
                <p-autoComplete [(ngModel)]="selectedClient" placeholder="Client" [suggestions]="clientSuggestions" (completeMethod)="clientAutoCompleteSearch($event)"></p-autoComplete>
                <p-dropdown [options]="clientOptions" [(ngModel)]="selectedClient" placeholder="Date" optionLabel="name" [showClear]="false"></p-dropdown>
                <p-dropdown [options]="clientOptions" [(ngModel)]="selectedClient" placeholder="Echéance" optionLabel="name" [showClear]="false"></p-dropdown>
                <p-dropdown [options]="clientOptions" [(ngModel)]="selectedClient" placeholder="Montant" optionLabel="name" [showClear]="false"></p-dropdown>
                <p-dropdown [options]="clientOptions" [(ngModel)]="selectedClient" placeholder="Statut" optionLabel="name" [showClear]="false"></p-dropdown>
                <button pButton pRipple class="filterBtn p-button-rounded  ml-2" label="Filtrer" icon="pi pi-filter"></button>
            </div>
        </div>



        <app-table [tableData]="devisList" [cols]="cols" [currency]="Currency" [styleClass]="'table'" (selectionChange)="selectionChange($event)" [styleId]="'devisList'" [loadLazy]="loadLazy" [events]="eventsSubject.asObservable()">
        </app-table>

        <div class="devisTotal flex justify-content-between
 align-items-center
 w-100">
            <span class="color-gray ">Total TTC</span>
            <span class="color-gray">720.00 MAD</span>
        </div>
    </div>



    <div class="w-43 md:col-12 p-0">
        <div class="devis-details">
            <div class="header flex justify-content-between
">
                <p-splitButton class=" border-radius-6" label="Brouillon" [model]="statusItems"></p-splitButton>
                <div class="flex">
                    <button pButton label="Télécharger" class="p-button-text"></button>
                    <button pButton label="Imprimer" class="p-button-text"></button>
                    <button pButton label="Dupliquer" class="p-button-text" (click)="duplicateDevis()"></button>
                    <button pButton label="Modifier" class="p-button-text" (click)="editDevis()"></button>
                    <button pButton label="Supprimer" class="p-button-text" (click)="deleteDevis()"></button>
                </div>
            </div>
            <div class="content pt-4 px-3">
                <div class="grid px-1">
                    <div class="col-5 pt-1">
                        <img src="assets/img/logo.png" alt="">
                    </div>
                    <div class="col-7 text-right">
                        <h1>Devis D00001</h1>
                        <p class="date my-1">Date d'émission: 01/01/2021</p>
                        <p class="date my-1">Date d'échéqnce: 31/01/2021</p>
                    </div>
                </div>
                <div class="grid px-1 py-4">
                    <div class="col-6 grid flex-column">
                        <span class="color-gray">Pour:</span>
                        <span>Omar Attioui</span>
                        <span>12 rue de Casablanca</span>
                        <span>Casablanca 2000</span>
                        <span>Maroc</span>
                        <span class="mt-3">06 69 99 99</span>
                    </div>
                    <div class="col-6 align-items-center
 grid flex-column">
                        <span class="color-gray">De</span>
                        <span>FACTURI</span>
                    </div>
                </div>

            </div>


            <p-table [columns]="DevisContentItemsCols" [value]="selectedDevisItem.contentItems">

                <ng-template pTemplate="header" let-yourColumnArrayVaraible>
                    <tr>
                        <ng-container *ngFor="let colVar of yourColumnArrayVaraible">
                            <th [colSpan]="colVar.colspan">
                                {{colVar.header}}
                            </th>
                        </ng-container>

                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-yourRowVaraible let-yourColumnArrayVaraible="columns">
                    <tr>
                        <ng-container *ngFor="let colVar of yourColumnArrayVaraible">
                            <ng-container [ngSwitch]="colVar.type">
                                <ng-container *ngSwitchCase="'date'">
                                    <td [colSpan]="colVar.colspan">
                                        {{yourRowVaraible[colVar.field] | date:'shortDate'}}
                                    </td>
                                </ng-container>
                                <ng-container *ngSwitchCase="'currency'">
                                    <td [colSpan]="colVar.colspan" mode="decimal">
                                        {{yourRowVaraible[colVar.field] | number:'1.2-2' }} {{' ' + Currency}}
                                    </td>
                                </ng-container>
                                <ng-container *ngSwitchCase="'pourcentage'">
                                    <td [colSpan]="colVar.colspan">
                                        {{yourRowVaraible[colVar.field] + '%'}}
                                    </td>
                                </ng-container>

                                <ng-container *ngSwitchDefault>
                                    <td [colSpan]="colVar.colspan">
                                        {{yourRowVaraible[colVar.field]}}
                                    </td>
                                </ng-container>

                            </ng-container>

                        </ng-container>

                    </tr>
                </ng-template>
                <ng-template pTemplate="summary" let-yourColumnArrayVaraible>

                    <div class="grid">
                        <div class="col-9">
                            <span>MONTANT TOTAL HT</span>
                        </div>
                        <div class="col-3">
                            <span>800.00 MAD</span>
                        </div>
                    </div>

                    <div class="grid">
                        <div class="col-9">
                            <span>REMISE</span>
                        </div>
                        <div class="col-3">
                            <span>200.00 MAD</span>
                        </div>
                    </div>

                    <div class="grid ">
                        <div class="col-9">
                            <span>TVA</span>
                        </div>
                        <div class="col-3">
                            <span>120.00 MAD</span>
                        </div>
                    </div>

                    <hr>

                    <div class="grid">
                        <div class="col-9">
                            <span>TOTAL ESTIME TTC</span>
                        </div>
                        <div class="col-3">
                            <span>720.00 MAD</span>
                        </div>
                    </div>

                </ng-template>

            </p-table>


        </div>
    </div>
</div>


<!-- Dialog -->
<app-devis-dialog [visible]="displayDialog" [devisItem]="selectedDevisItem" (closeDialog)="displayDialog = false" [SelectDevisItemEvent]="notifySelectedDevisChanged.asObservable()">
</app-devis-dialog>